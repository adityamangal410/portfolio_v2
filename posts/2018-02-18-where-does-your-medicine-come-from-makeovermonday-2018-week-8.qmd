---
title: 'Where Does Your Medicine Come From?: MakeOverMonday 2018 Week 8'
author: Aditya Mangal
date: '2018-02-18'
categories:
- MakeOverMonday
keywords:
- tech
- DataAnalysis
- DataScience
- MakeOverMonday
- Medicine
- Visualizations
- R
summary: Goal of this Visualization task is to create a visualization for the [Drug
  and Medicine Exports data for different countries.](https://www.trademap.org/Country_SelProduct_TS.aspx?nvpm=1|||||3004|||4|1|1|2|2|1|2|1|1)
readingtime: '5'
coverImage: https://lh3.googleusercontent.com/Q2HXmhvfyNs3DnEd5u1q9CYHiOB9l-fX4XBzBuBYNKRipmFzpoM8s-vcRuJAw3Tm_sXpH_xOIgJI4vjiXkOxDZmiWmM1Du9XOLIsoEtPUWXovhBmVXEIZI7yn_j3GLMwoBOQ_pzSpe5mxkfK6FxtIr6OGLAkOAHU9dUpz2jyUfCU-J9CiiJYC5m_OpyeVaujFyq8J2FreRRH9vbrHcKIj7K1nVKk5Ud_t9P8DtB_DffFMXKlr-UaphCGba3RA4rPovIVYJGxFZjEMCuDETSlE64bRY-PSGpvnvWA_op8k07tk_SbWaoQC53PMSGtCe5Gv1-INBYeXOF3_ULYj755xnfRm4UWjScEr0oNgDKHQyYLrf81lZF2yhXSdTt3UrBMZPh4sfsPLrsK5UzG8SwI15Nq6yLal16Egk5ZMW_bow8PjvuBvZbgoZmVrlU4EqOoEdbdRyxlii20Ku-veLhexOrrVL-SADDIYsfUM4dbIiaxF0ZNQewrThrPXcppsKulZTBnVYde1f7hVmxT0OYxw9Q5y00VXeVziwM5J-_I0wOTcNfTXb2g8k7_wrY9-GgrwUIGPSXZkdVYUJhqMrxKPalFOCbeoE7VbiobaJALA6qWD8lxey-uesWq9_6hetauVAk_W8ameuW4u8kWdJpLbciOfc_3joMs=w2750-h1832-no
thumbnailImage: https://lh3.googleusercontent.com/5wIFfhutkaFsqnv2M72bnV_hFyJ_0d6y_Lu11O3U9Kx9XCD_WIGpMZCBl1iXJWzt63JsquXvi7TwNcNy6FGd_v5zq8PH2o7UhTqVIraM8Re5UGWb0myvjgzwsl080wnIXAwCx6s8oRkxXgIE5OzIar_Fw6kPcXJLIaTho3Q2lSWVac9p_U1vxNlbgWsf16aKc2lKWjkwHTaE6Hj2NnchUAXJ_6TpnoUiran--qVOKgkwQcCtEqo7DulTQxEuBZaQV9yoGTt6jbrgmwcquzR1OqTezSyLCzp_D6hK-GSkRYyvxAmRg2PvB1HedzzmiQ67y-32Z0bctMcUBigffgX3P_H9hO5v-K--dyDM-mBDHByiBkJ-ltrm0GdoMEARmE6E0kC4oy2afPX9_-PzDFhnK7_I-TXLt-1yO63abxRM2weynQ9qJHka6tyOiom3xTl1B8nkpwo1UfHkbF9MGOBER32zb86JVLmR9fJJZvLAMNjyYefxLb7BdP1CHeSvAK7CZMOkgdLJ3BQ7a4PAbKLUJTXPGiFaMRwmzbrx6OrUNNQnA3qF_bfW7ALEs3PnwDlXPJ3GBOnH8KOqfAU_ChQSW4rwlaqKa4d8O5mc_RMUNgSuTXYe6Q3TsXW7c_VPz7QLcC5spGONtyJQ9T6CRvAxXq2mtI5zRUdu=w750-h500-no
thumbnailImagePosition: left
coverCaption: Photo by Simone van der Koelen on Unsplash
format:
  html:
    theme: distill
freeze: true
output-file: where-does-your-medicine-come-from-makeovermonday-2018-week-8.html
---

# Introduction
Goal of this Visualization task is to create a visualization for the [Drug and Medicine Exports data for different countries.](https://www.trademap.org/Country_SelProduct_TS.aspx?nvpm=1|||||3004|||4|1|1|2|2|1|2|1|1)
In this blog post, I’m trying to find the leading countries in Export across these 5 years.

# Analysis

## Cleaning up workspace and loading required libraries
```r
rm(list = ls())
```
```r
library(tidyverse) #Data Wrangling
library("httr")
library(readxl) #Data Ingestion
library(ggplot2) #Data Visualization
```

## Obtaining Data
Reading and viewing the dataset
```r
GET("https://query.data.world/s/utmlfljjzc2naoeielefxsf4fh5qkf", write_disk(tf <- tempfile(fileext = ".xlsx")))
```
```r
drugs <- read_excel(tf)
```
```r
drugs
```
```
## # A tibble: 1,100 x 3
##    Exporter                  Year `Exports (USD)`
##    <chr>                    <dbl>           <dbl>
##  1 World                     2013    326445385000
##  2 Germany                   2013     48493611000
##  3 Switzerland               2013     32337891000
##  4 Belgium                   2013     33329615000
##  5 France                    2013     27848920000
##  6 United States of America  2013     23098676000
##  7 United Kingdom            2013     20885936000
##  8 Ireland                   2013     18152573000
##  9 Italy                     2013     20898532000
## 10 Netherlands               2013     13480651000
## # … with 1,090 more rows
```
Summarizing and getting stats to better understand the dataset
```r
drugs %>%
  glimpse()
```
```
## Rows: 1,100
## Columns: 3
## $ Exporter        <chr> "World", "Germany", "Switzerland", "Belgium", "France…
## $ Year            <dbl> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,…
## $ `Exports (USD)` <dbl> 326445385000, 48493611000, 32337891000, 33329615000, …
```
```r
drugs %>%
  summary()
```
```
##    Exporter              Year      Exports (USD)
##  Length:1100        Min.   :2013   Min.   :0.000e+00
##  Class :character   1st Qu.:2014   1st Qu.:1.212e+05
##  Mode  :character   Median :2015   Median :7.393e+06
##                     Mean   :2015   Mean   :3.315e+09
##                     3rd Qu.:2016   3rd Qu.:3.293e+08
##                     Max.   :2017   Max.   :3.405e+11
##                                    NA's   :266
```

## Scrubbing data
Removing rows with NA for the purposes of this visualization
```r
drugs = drugs %>%
  filter(!is.na(`Exports (USD)`))
```
Let’s see overall which are the Countries with highest export over these 5 years.
```r
drugs %>%
  group_by(Exporter) %>%
  summarise(TotalExport = sum(`Exports (USD)`)) %>%
  arrange(desc(TotalExport))
```
```
## # A tibble: 220 x 2
##    Exporter                   TotalExport
##    <chr>                            <dbl>
##  1 World                    1309425248000
##  2 Germany                   197463838000
##  3 Switzerland               183296295000
##  4 France                    123482590000
##  5 Belgium                   117396245000
##  6 United States of America  114868001000
##  7 United Kingdom            110713945000
##  8 Ireland                    96686923000
##  9 Italy                      76012918000
## 10 Netherlands                59659401000
## # … with 210 more rows
```

## Exploring Data
Lets plot the countries which were among the top 5 exporters each year and each of their performance over these 5 years.
```r
top5ExportersByYear = drugs %>%
  filter(Exporter!="World") %>%
  group_by(Year) %>%
  top_n(5, `Exports (USD)`) %>%
  ungroup()
```
```r
g = ggplot(data = top5ExportersByYear, aes(x = Year, y = `Exports (USD)`))
g + geom_line(aes(color = Exporter)) + labs(title = 'Trend for top 5 exporters in the world over the years')
```
<img src="/post/2018-02-18-where-does-your-medicine-come-from-makeovermonday-2018-week-8_files/figure-html/unnamed-chunk-4-1.png" width="672" />
Evaluating Top 10 exporters per Year. Excluding 2017 since we do not have numbers for total export in the world.
```r
getTop10ForYear = function(df){
  top10ForYear = df %>%
    filter(Exporter!="World") %>%
    top_n(10, `Exports (USD)`)

  othersExports = (df %>% filter(Exporter=="World") %>% select(`Exports (USD)`)) - (top10ForYear %>% summarise(Total = sum(`Exports (USD)`)))

  YEAR = df %>% select(Year) %>% unique() %>% .$Year
  top10ForYear = top10ForYear %>%
    add_row(Exporter = "Others", Year = YEAR, `Exports (USD)` = othersExports %>% .$`Exports (USD)`)
  return(top10ForYear)
}
yearlyTop10s = drugs %>%
  filter(Year != 2017) %>%
  group_by(Year) %>%
  do(getTop10ForYear(.))
yearlyTop10s
```
```
## # A tibble: 44 x 3
##    Exporter                  Year `Exports (USD)`
##    <chr>                    <dbl>           <dbl>
##  1 Germany                   2013     48493611000
##  2 Switzerland               2013     32337891000
##  3 Belgium                   2013     33329615000
##  4 France                    2013     27848920000
##  5 United States of America  2013     23098676000
##  6 United Kingdom            2013     20885936000
##  7 Ireland                   2013     18152573000
##  8 Italy                     2013     20898532000
##  9 Netherlands               2013     13480651000
## 10 India                     2013     10313989000
## # … with 34 more rows
```
Writing function to plot a Donut Chart for each year showing percentage export contribution for top 10 exporters of that year as compared to all others.
```r
plotTop10 = function(df){
  YEAR = df %>% select(Year) %>% unique() %>% .$Year
  plotTitle = paste("World Medicine Export in", YEAR, sep = " ")

  df = df %>%
    mutate(tot = sum(`Exports (USD)`),
           prop = round(100*`Exports (USD)`/tot,2))

  p = ggplot(df, aes(x=2, y=prop, fill=Exporter)) +
    geom_bar(stat="identity") +
    geom_text( aes(label = prop), position = position_stack(vjust = 0.5)) +
    xlim(0.5, 2.5) +
    coord_polar(theta = "y") +
    labs(x=NULL, y=NULL) +
    labs(fill="") +
    ggtitle(plotTitle) +
    theme_bw() +
    theme(plot.title = element_text(face="bold",family=c("sans"),size=15),
          legend.text=element_text(size=10),
          axis.ticks=element_blank(),
          axis.text=element_blank(),
          axis.title=element_blank(),
          panel.grid=element_blank(),
          panel.border=element_blank())
  return(p)
}
```
Plotting the donuts for each year
```r
plotTop10(yearlyTop10s %>% filter(Year==2013))
```
<img src="/post/2018-02-18-where-does-your-medicine-come-from-makeovermonday-2018-week-8_files/figure-html/unnamed-chunk-7-1.png" width="672" />
```r
plotTop10(yearlyTop10s %>% filter(Year==2014))
```
<img src="/post/2018-02-18-where-does-your-medicine-come-from-makeovermonday-2018-week-8_files/figure-html/unnamed-chunk-7-2.png" width="672" />
```r
plotTop10(yearlyTop10s %>% filter(Year==2015))
```
<img src="/post/2018-02-18-where-does-your-medicine-come-from-makeovermonday-2018-week-8_files/figure-html/unnamed-chunk-7-3.png" width="672" />
```r
plotTop10(yearlyTop10s %>% filter(Year==2016))
```
<img src="/post/2018-02-18-where-does-your-medicine-come-from-makeovermonday-2018-week-8_files/figure-html/unnamed-chunk-7-4.png" width="672" />
As can be seen Germany remains the biggest exporter of Drugs and Medicines over the past 5 years.
